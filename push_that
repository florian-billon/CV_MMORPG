#!/bin/bash
# push_that.sh
# A helper script to add, commit, and push changes to a Git repository.

# Exit immediately if a command exits with a non-zero status
set -e

# Check if a commit message was provided
if [ -z "$1" ]; then
  echo "âŒ Error: No commit message provided."
  echo "Usage: ./push_that.sh \"Your commit message\""
  exit 1
fi

COMMIT_MSG="$1"

echo "ğŸ”„ Adding all files..."
git add -A

echo "ğŸ“ Committing with message: \"$COMMIT_MSG\""
# If there are no changes to commit, skip gracefully
if git diff --cached --quiet; then
  echo "âš ï¸  No changes to commit."
else
  git commit -m "$COMMIT_MSG"
fi

echo "â¬†ï¸  Pushing to remote..."
# Try to push, if rejected (e.g., remote ahead), pull and retry
if ! git push; then
  echo "âš ï¸  Push failed. Trying to pull and re-push..."
  git pull --rebase || git pull --no-rebase
  git push
fi

echo "âœ… Done! Your changes are now on the remote repository."
